# Лицензии Face SDK

Доступны следующие типы лицензий: 

* По [типу активации](#активация-лицензии): 
    * [Онлайн](#онлайн-лицензии) – требуется подключение к Интернету для активации и периодического подтверждения, возможен перенос на другие устройства
    * [Оффлайн](#оффлайн-лицензии) – привязка к устройству или USB-токену, возможность переноса между устройствами отсутствует

* По [типу привязки](#привязка-лицензии): 
    * [Application ID](#привязка-к-application-id) – привязка к iOS- или Android-приложению
    * [Hardware ID](#привязка-к-hardware-id) – привязка к сигнатуре устройства
    * [USB-токен](#привязка-к-usb-токену) – устройство, используемое вместо стандартного файла лицензии

Если у Вас остались какие-либо вопросы, напишите нам: face@3divi.com

## Активация лицензии

### Онлайн лицензии

* По умолчанию рабочей директорией для онлайн лицензии является каталог *license*. При необходимости можно использовать другую директорию – все приложения, использующие *3DiVi Face SDK*, должны иметь к этой директории доступ на чтение и запись. Скопируйте в эту директорию файлы `log_params.xml` и `net_params.xml` из каталога *license*.
* Скачайте файл лицензии с сервера онлайн лицензий.
* Скопируйте файл лицензии в рабочую директорию онлайн лицензии и переименуйте его в `3divi_face_sdk.lic`.
* При вызове `FacerecService.createService` передайте путь до рабочей директории онлайн лицензии в аргументе `license_dir` (можно оставить пустым, если используется каталог по умолчанию).

Пока выполняется одно или несколько приложений, использующих *3DiVi Face SDK* с онлайн лицензией, файл лицензии будет регулярно обновляться (в фоновом процессе). Обновление лицензии включает в себя продление срока действия лицензии и, при необходимости, изменение ключа оборудования.

Параметры сети, используемые при обновлении лицензии, хранятся в файле `net_params.xml`:
* `timeout` – таймаут в секундах
* `use_system_proxy` – `yes` или `no`, поставьте `yes`, чтобы использовать системные настройки прокси
* `no_proxy_for_server` – `yes` или `no`, поставьте `yes`, чтобы не использовать прокси
* `proxy` – поставьте `url:port` для использования прокси, при условии, что для параметров `use_system_proxy` и `no_proxy_for_server` был выбран вариант `no`

### Оффлайн лицензии

Чтобы активировать лицензию на Лицензионном портале Face SDK, следуйте инструкции ниже:

* Распакуйте архив с дистрибутивом в любую директорию на Вашем устройстве (см. [Приступая к работе](README.md#приступая-к-работе)).
* Создайте/получите файл `3divi_face_sdk.lic`, который будет содержать в себе информацию о Вашем устройстве, необходимую для процедуры лицензирования: 
    * [Windows/Linux] Запустите утилиту *get_license* из папки *bin* на целевом компьютере/устройстве. После этого в папке *bin* будет создан файл `3divi_face_sdk.lic`. 
    * [Android] Вызовите функцию `FacerecService.getLicenseState` и получите поле `LicenseState.hardware_reg` (пример получения *Hardware ID* см. в [Android Demo](/examples/android/demo/src/main/java/com/vdt/face_recognition/demo/MainActivity.java)). Сообщите *Hardware ID* Вашему личному менеджеру. В ответ Вам будет отправлен файл `3divi_face_sdk.lic`.
* Войдите в [Лицензионный портал Face SDK](https://cognitive.3divi.com/app/face/login/). Если Вы не помните свой пароль, Вы можете сбросить его [на этой странице](https://cognitive.3divi.com/app/face/forgot-password/).
* Выберите *Face SDK* в меню в левой части страницы.
* Выберите файл лицензии, сгенерированный на лицензионном портале компанией 3DiVi (см. изображение ниже). 

<p align="center">
<img width="700" src="/doc/img/off_lic_fsdk.png"><br>
<b>Выбор файла лицензии из списка созданных лицензий</b><br>
</p>

* Нажмите на название лицензии. В результате этого появится окно с подробной информацией о файле лицензии.
* Нажмите на кнопку *Upload file*.

<p align="center">
<img width="600" src="/doc/img/off_lic_file.png"><br>
<b>Загрузка файла лицензии на Лицензионном портале Face SDK</b><br>
</p>

* После этого появится окно "Activate FaceSDK license". Нажмите на кнопку *Upload*, чтобы загрузить файл `3divi_face_sdk.lic` из папки *bin*.

<p align="center">
<img width="300" src="/doc/img/off_lic_upload.png"><br>
<b>Активация файла лицензии</b><br>
</p>

* Нажмите на кнопку *Generate*, чтобы сгенерировать финальный файл лицензии, привязанный к Вашему устройству. 
* Поместите файл лицензии в директорию *license* и при необходимости переименуйте его в `3divi_face_sdk.lic`.

## Привязка лицензии 

В зависимости от типа привязки, некоторые типы лицензий позволяют использовать Face SDK только на определенных устройствах. На данный момент доступны следующие типы привязки лицензий Face SDK:

* *Без привязки* – лицензия позволяет использовать Face SDK на любом устройстве.
* *Привязка к платформе* – лицензия может быть запущена только на устройствах с определенной платформой (Windows/Linux/Android/iOS).
* *Привязка к Application ID* – лицензия позволяет использовать Face SDK только в составе определенного приложения (доступно для Android и iOS).
* *Привязка к Hardware ID* – лицензия позволяет использовать Face SDK только на определенном устройстве (доступно для Windows, Linux и Android).
* *Привязка к USB-ключу* – лицензия позволяет использовать Face SDK только на устройстве, к которому подключен специальный USB-ключ (доступно для Windows и Linux).

### Привязка к Hardware ID

Привязка к *Hardware ID*  позволяет использовать *Face SDK* только на определенном устройстве. Привязка к устройству происходит в момент активации лицензии. Для онлайн лицензий привязка происходит автоматически в момент первого запуска библиотеки. Для оффлайн лицензий перед активацией необходимо получить *Hardware ID* на целевом устройстве. Инструкция по привязке оффлайн лицензий к *Hardware ID* представлена в пункте [Оффлайн лицензии](#оффлайн-лицензии). 

Онлайн-лицензии с привязкой к *Hardware ID* могут быть перенесены на другое устройство, однако одновременно лицензия может использоваться только на одном устройстве. Для переноса лицензии повторно скачайте файл лицензии `3divi_face_sdk.lic` в личном кабинете Face SDK и поместите его в папку *license* на новом устройстве. **Не переносите файл лицензии с предыдущего устройства**, т.к. в таком случае при перепривязке лицензии возникнет ошибка.

### Привязка к Application ID

Вы можете привязать лицензию *Face SDK* к разработанному мобильному приложению. В этом случае пользователям Вашего приложения не понадобится приобретать или активировать лицензию. Для привязки лицензии Вам потребуется указать идентификатор приложения (`android_app_id` для Android-приложения или `ios_app_id` для iOS-приложения). Идентификатор приложения необходимо получать **тогда, когда приложение подписано для релиза**, в противном случае идентификатор изменится, и лицензия станет недействительной.

Чтобы получить идентификатор приложения, вызовите метод `FacerecService.getLicenseState` в приложении и выведите поле `android_app_id` или `ios_app_id` результата в *logcat*. Приобретите лицензию для Вашего приложения, указав полученный идентификатор. Используйте этот файл лицензии в приложении. Теперь Ваше приложение будет работать на любых Android/iOS-устройствах (в зависимости от целевой платформы). Одну и ту же лицензию нельзя использовать для нескольких приложений (разные приложения имеют разный идентификатор, и для каждого приложения должна быть своя лицензия).

### Привязка к USB-токену 

USB-токен — это физическое устройство, которое может использоваться вместо стандарного файла лицензии. Как и файл лицензии, USB-токен содержит информацию о количестве приобретенных компонент *Face SDK*. В отличие от файла лицензии, USB-токен не привязывается к сигнатуре аппаратного оборудования — достаточно вставить USB-токен в используемое устройство. USB-токен защищен от копирования. Один USB-токен может быть использован только одним процессом, т.е. для запуска еще одного процесса потребуется еще один USB-токен.

Для лицензирования Face SDK с USB-токеном вместо файла лицензии необходимо воспользоваться одним из перечисленных ниже вариантов:
* в параметре `license_dir` функции `FacerecService.createService` указать `0x436e9514-hardware-key-serial-<key>`
* в файле `3divi_face_sdk.lic` заменить стандартное содержимое лицензии на строку `hardware_key_serial <key>`

где `key` — серийный номер USB-токена. Пример: `senselock1234560000000f7e`

В случае, если USB-токен с указанным серийным номером не обнаружен, в тексте исключения, выброшенного методом `FacerecService.createService`, будет приведен список всех доступных USB-токенов с их серийными номерами.

Поддержка USB-токенов добавлена в следующих сборках:
* Linux x86_32
* Linux x86_64
* Windows x86_32
* Windows x86_64
